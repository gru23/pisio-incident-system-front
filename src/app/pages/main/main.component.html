<mat-card class="filter-container">
  <mat-card-title>Filter</mat-card-title>
  <mat-card-content [formGroup]="filterForm">
    <div class="filter-row">
      <!-- Lokacija -->
      <mat-form-field appearance="fill" class="location-field">
        <mat-label>Location</mat-label>
        <input
          matInput
          formControlName="location"
          placeholder="Enter city or street"
        />
      </mat-form-field>

      <!-- Vrsta incidenta -->
      <mat-form-field appearance="fill" class="type-field">
        <mat-label>Type</mat-label>
        <mat-select
          formControlName="type"
          (selectionChange)="onTypeChange('filter')"
        >
          <mat-option *ngFor="let type of incidentTypes" [value]="type.type">
            {{ type.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="fill" class="type-field">
        <mat-label>Subtype</mat-label>
        <mat-select
          formControlName="subtype"
          [disabled]="!filterForm.get('type')?.value"
        >
          <mat-option
            *ngFor="let subtype of selectedFilterSubtypes"
            [value]="subtype"
          >
            {{ getSubtypeName(subtype) }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Vremenski opseg -->
      <mat-form-field appearance="fill" class="time-field">
        <mat-label>Time</mat-label>
        <mat-select formControlName="time">
          <mat-option *ngFor="let t of timeRanges" [value]="t.value">
            {{ t.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Dugme za filtriranje -->
      <button mat-raised-button color="primary" (click)="applyFilter()">
        <mat-icon>filter_alt</mat-icon> Filter
      </button>

      <!-- Dugme za reset -->
      <button mat-stroked-button color="warn" (click)="clearFilters()">
        <mat-icon>filter_alt_off</mat-icon> Reset
      </button>
    </div>
  </mat-card-content>
</mat-card>

<div class="map-container">
  <app-map [incidents]="approvedIncidents" (locationSelected)="onMapLocationSelected($event)"></app-map>
</div>

<hr />

<div class="add-incident-container">
  <mat-card class="report-container">
    <mat-card-title>Submit incident</mat-card-title>
    <form [formGroup]="submitForm" (ngSubmit)="onSubmit()">
      <div class="form-row">
        <!-- Adresa -->
        <mat-form-field appearance="fill">
          <mat-label>Address</mat-label>
          <input
            matInput
            formControlName="address"
            placeholder="Street, city, country"
          />
          <mat-error *ngIf="submitForm.get('address')?.hasError('required') && submitForm.get('address')?.touched">
            Address is required.
          </mat-error>
        </mat-form-field>

        <!-- Vrsta incidenta -->
        <mat-form-field appearance="fill">
          <mat-label>Type</mat-label>
          <mat-select
            formControlName="type"
            (selectionChange)="onTypeChange('submit')"
          >
            <mat-option *ngFor="let type of incidentTypes" [value]="type.type">
              {{ type.name }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="submitForm.get('type')?.hasError('required') && submitForm.get('type')?.touched">
            Type is required.
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Subtype</mat-label>
          <mat-select
            formControlName="subtype"
            [disabled]="!submitForm.get('type')?.value"
          >
            <mat-option
              *ngFor="let subtype of selectedSubmitSubtypes"
              [value]="subtype"
            >
              {{ getSubtypeName(subtype) }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Slika -->
        <button mat-button color="primary" component="label">
          <mat-icon>upload</mat-icon> Image
          <input
            type="file"
            accept="image/*"
            hidden
            (change)="onImageSelect($event)"
          />
        </button>

        <!-- Submit dugme -->
        <button mat-raised-button color="accent" type="submit">
          <mat-icon>send</mat-icon> Submit
        </button>
      </div>

      <!-- Opis -->
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Description</mat-label>
        <textarea
          matInput
          rows="4"
          formControlName="description"
          placeholder="Enter details..."
        ></textarea>
      </mat-form-field>
    </form>
  </mat-card>
</div>
